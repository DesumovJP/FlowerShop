# üê≥ –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è Docker –¥–ª—è Strapi –∑ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è–º —Ñ–∞–π–ª—ñ–≤

## ‚úÖ –©–æ –±—É–ª–æ –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–æ

### 1. Dockerfile –æ–Ω–æ–≤–ª–µ–Ω–æ
- –î–æ–¥–∞–Ω–æ —Å–∏—Å—Ç–µ–º–Ω—ñ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ –¥–ª—è Sharp (vips-dev, python3, make, g++)
- –ù–∞–ª–∞—à—Ç–æ–≤–∞–Ω–æ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø—É –¥–ª—è uploads –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—ó
- –°—Ç–≤–æ—Ä–µ–Ω–æ –±–µ–∑–ø–µ—á–Ω–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ strapi
- –û–ø—Ç–∏–º—ñ–∑–æ–≤–∞–Ω–æ –∫–µ—à—É–≤–∞–Ω–Ω—è Docker

### 2. docker-compose.yml –æ–Ω–æ–≤–ª–µ–Ω–æ
- –î–æ–¥–∞–Ω–æ –∑–º—ñ–Ω–Ω—ñ —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞ –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ—ó —Ä–æ–±–æ—Ç–∏
- –ù–∞–ª–∞—à—Ç–æ–≤–∞–Ω–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –¥–ª—è –±–µ–∑–ø–µ–∫–∏
- –ü—ñ–¥–∫–ª—é—á–µ–Ω–æ volumes –¥–ª—è uploads

### 3. Strapi –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è
- **plugins.ts**: –ù–∞–ª–∞—à—Ç–æ–≤–∞–Ω–æ upload plugin –∑ –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—î—é –∑–æ–±—Ä–∞–∂–µ–Ω—å
- **middlewares.ts**: –ù–∞–ª–∞—à—Ç–æ–≤–∞–Ω–æ CORS —Ç–∞ –æ–±–º–µ–∂–µ–Ω–Ω—è —Ä–æ–∑–º—ñ—Ä—É —Ñ–∞–π–ª—ñ–≤
- **package.json**: –î–æ–¥–∞–Ω–æ Sharp –¥–ª—è –æ–±—Ä–æ–±–∫–∏ –∑–æ–±—Ä–∞–∂–µ–Ω—å

### 4. –°—Ö–µ–º–∏ –∫–æ–Ω—Ç–µ–Ω—Ç—É
- **Bouquet**: –ü—ñ–¥—Ç—Ä–∏–º—É—î –º–Ω–æ–∂–∏–Ω–Ω—ñ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è
- **Singleflower**: –ü—ñ–¥—Ç—Ä–∏–º—É—î –º–Ω–æ–∂–∏–Ω–Ω—ñ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è
- –û–±–∏–¥–≤—ñ —Å—Ö–µ–º–∏ –º–∞—é—Ç—å UID –ø–æ–ª—è –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ—ó —Ä–æ–±–æ—Ç–∏ –∑ API

## üöÄ –Ü–Ω—Å—Ç—Ä—É–∫—Ü—ñ—ó –¥–ª—è –∑–∞–ø—É—Å–∫—É

### –ö—Ä–æ–∫ 1: –ü–µ—Ä–µ–±—É–¥–æ–≤–∞ Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞

**–î–ª—è Windows:**
```bash
# –ó–∞–ø—É—Å—Ç—ñ—Ç—å —Ü–µ–π —Ñ–∞–π–ª
rebuild-docker.bat
```

**–î–ª—è Linux/Mac:**
```bash
# –ó—Ä–æ–±—ñ—Ç—å —Ñ–∞–π–ª –≤–∏–∫–æ–Ω—É–≤–∞–Ω–∏–º
chmod +x rebuild-docker.sh

# –ó–∞–ø—É—Å—Ç—ñ—Ç—å —Å–∫—Ä–∏–ø—Ç
./rebuild-docker.sh
```

**–ê–±–æ –≤—Ä—É—á–Ω—É:**
```bash
# –ó—É–ø–∏–Ω–∏—Ç–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏
docker-compose down

# –í–∏–¥–∞–ª–∏—Ç–∏ —Å—Ç–∞—Ä–∏–π –æ–±—Ä–∞–∑
docker rmi flowershop3-strapi

# –û—á–∏—Å—Ç–∏—Ç–∏ –∫–µ—à
docker system prune -f

# –ü–µ—Ä–µ–±—É–¥—É–≤–∞—Ç–∏
docker-compose build --no-cache

# –ó–∞–ø—É—Å—Ç–∏—Ç–∏
docker-compose up -d
```

### –ö—Ä–æ–∫ 2: –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Ä–æ–±–æ—Ç–∏

1. **–í—ñ–¥–∫—Ä–∏–π—Ç–µ Strapi –∞–¥–º—ñ–Ω–∫—É**: http://localhost:1337/admin
2. **–ü–µ—Ä–µ–π–¥—ñ—Ç—å –¥–æ Content Manager**
3. **–°—Ç–≤–æ—Ä—ñ—Ç—å –Ω–æ–≤–∏–π Bouquet –∞–±–æ Singleflower**
4. **–°–ø—Ä–æ–±—É–π—Ç–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è**

### –ö—Ä–æ–∫ 3: –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ª–æ–≥—ñ–≤

```bash
# –ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ –ª–æ–≥–∏ Strapi
docker-compose logs -f strapi

# –ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ –ª–æ–≥–∏ –≤—Å—ñ—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
docker-compose logs -f
```

## üîß –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ñ–∞–π–ª—ñ–≤

### –†–æ–∑–º—ñ—Ä–∏ —Ñ–∞–π–ª—ñ–≤
- **–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∏–π —Ä–æ–∑–º—ñ—Ä —Ñ–∞–π–ª—É**: 10MB
- **–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∏–π —Ä–æ–∑–º—ñ—Ä —Ñ–æ—Ä–º–∏**: 256MB
- **–ü—ñ–¥—Ç—Ä–∏–º—É–≤–∞–Ω—ñ —Ñ–æ—Ä–º–∞—Ç–∏**: JPG, PNG, GIF, WebP

### –û–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—è –∑–æ–±—Ä–∞–∂–µ–Ω—å
- **Breakpoints**: xlarge (1920px), large (1000px), medium (750px), small (500px), xsmall (64px)
- **Responsive dimensions**: –£–≤—ñ–º–∫–Ω–µ–Ω–æ
- **Optimization**: –£–≤—ñ–º–∫–Ω–µ–Ω–æ

### –ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø—É
- **Uploads –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—è**: `/app/backend/public/uploads`
- **–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á**: strapi (UID: 1001)
- **–ü—Ä–∞–≤–∞**: 755 (rwxr-xr-x)

## üêõ –í–∏—Ä—ñ—à–µ–Ω–Ω—è –ø—Ä–æ–±–ª–µ–º

### –ü—Ä–æ–±–ª–µ–º–∞: "EPERM: operation not permitted"
**–†—ñ—à–µ–Ω–Ω—è**: –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç—ñ—Ç—å Docker –∑ –Ω–æ–≤–∏–º–∏ –ø—Ä–∞–≤–∞–º–∏ –¥–æ—Å—Ç—É–ø—É
```bash
docker-compose down
docker-compose up -d
```

### –ü—Ä–æ–±–ª–µ–º–∞: "Sharp module not found"
**–†—ñ—à–µ–Ω–Ω—è**: –ü–µ—Ä–µ–±—É–¥—É–π—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
```bash
docker-compose build --no-cache
```

### –ü—Ä–æ–±–ª–µ–º–∞: "CORS error"
**–†—ñ—à–µ–Ω–Ω—è**: –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ, —â–æ frontend –∑–∞–ø—É—â–µ–Ω–∏–π –Ω–∞ localhost:3000

### –ü—Ä–æ–±–ª–µ–º–∞: "File too large"
**–†—ñ—à–µ–Ω–Ω—è**: –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —Ä–æ–∑–º—ñ—Ä —Ñ–∞–π–ª—É (–º–∞–∫—Å–∏–º—É–º 10MB)

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª—ñ–≤

```
uploads/
‚îú‚îÄ‚îÄ [timestamp]_[filename].jpg    # –û—Ä–∏–≥—ñ–Ω–∞–ª—å–Ω—ñ —Ñ–∞–π–ª–∏
‚îú‚îÄ‚îÄ [timestamp]_[filename]_large.jpg    # –û–ø—Ç–∏–º—ñ–∑–æ–≤–∞–Ω—ñ –≤–µ—Ä—Å—ñ—ó
‚îú‚îÄ‚îÄ [timestamp]_[filename]_medium.jpg
‚îî‚îÄ‚îÄ [timestamp]_[filename]_small.jpg
```

## üîç –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è

### 1. –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —á–µ—Ä–µ–∑ –∞–¥–º—ñ–Ω–∫—É
1. –í—ñ–¥–∫—Ä–∏–π—Ç–µ http://localhost:1337/admin
2. –ü–µ—Ä–µ–π–¥—ñ—Ç—å –¥–æ Content Manager
3. –°—Ç–≤–æ—Ä—ñ—Ç—å –Ω–æ–≤–∏–π Bouquet
4. –ó–∞–≤–∞–Ω—Ç–∞–∂—Ç–µ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è
5. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ, —â–æ —Ñ–∞–π–ª –∑'—è–≤–∏–≤—Å—è –≤ uploads –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—ó

### 2. –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —á–µ—Ä–µ–∑ API
```bash
curl -X POST http://localhost:1337/api/upload \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -F "files=@test-image.jpg" \
  -F "ref=api::bouquet.bouquet" \
  -F "refId=YOUR_BOUQUET_ID" \
  -F "field=image"
```

## ‚úÖ –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —É—Å–ø—ñ—à–Ω–æ–≥–æ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è

–Ø–∫—â–æ –≤—Å–µ –ø—Ä–∞—Ü—é—î –ø—Ä–∞–≤–∏–ª—å–Ω–æ, –≤–∏ –ø–æ–≤–∏–Ω–Ω—ñ –ø–æ–±–∞—á–∏—Ç–∏:
- ‚úÖ Strapi –∑–∞–ø—É—Å–∫–∞—î—Ç—å—Å—è –±–µ–∑ –ø–æ–º–∏–ª–æ–∫
- ‚úÖ –ú–æ–∂–µ—Ç–µ –∑–∞–≤–∞–Ω—Ç–∞–∂—É–≤–∞—Ç–∏ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è –≤ –∞–¥–º—ñ–Ω—Ü—ñ
- ‚úÖ –§–∞–π–ª–∏ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è –≤ uploads –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—ó
- ‚úÖ –ó–æ–±—Ä–∞–∂–µ–Ω–Ω—è –≤—ñ–¥–æ–±—Ä–∞–∂–∞—é—Ç—å—Å—è –≤ Content Manager
- ‚úÖ –ù–µ–º–∞—î –ø–æ–º–∏–ª–æ–∫ Sharp –∞–±–æ EPERM

## üÜò –Ø–∫—â–æ —â–æ—Å—å –Ω–µ –ø—Ä–∞—Ü—é—î

1. **–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –ª–æ–≥–∏**: `docker-compose logs -f strapi`
2. **–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç—ñ—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä**: `docker-compose restart`
3. **–ü–µ—Ä–µ–±—É–¥—É–π—Ç–µ –æ–±—Ä–∞–∑**: `docker-compose build --no-cache`
4. **–û—á–∏—Å—Ç—ñ—Ç—å –∫–µ—à**: `docker system prune -f`

---

**–ì–æ—Ç–æ–≤–æ!** üéâ –¢–µ–ø–µ—Ä –≤–∏ –º–æ–∂–µ—Ç–µ –∑–∞–≤–∞–Ω—Ç–∞–∂—É–≤–∞—Ç–∏ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è –¥–ª—è –±—É–∫–µ—Ç—ñ–≤ —Ç–∞ –æ–¥–∏–Ω–æ—á–Ω–∏—Ö –∫–≤—ñ—Ç—ñ–≤ –≤ –∞–¥–º—ñ–Ω—Ü—ñ Strapi –±–µ–∑ –ø–æ–º–∏–ª–æ–∫ EPERM —Ç–∞ Sharp.









